<!DOCTYPE html>
<html lang="en">

<head>
	<meta name="generator" content="Hugo 0.16" />
  <meta charset="UTF-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  

  <title>
    Writing an OS in Rust
  </title>

  <link rel="canonical" href="http://os.phil-opp.com/">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/syntax.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/images/favicon.ico">

  
    <link href="/atom.xml" rel="alternate" type="application/rss+xml" title="Writing an OS in Rust" />
    <link href="/atom.xml" rel="feed" type="application/rss+xml" title="Writing an OS in Rust" />
  

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
  <script src="js/toc.min.js"></script>
  <script src="js/main.js"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65296949-1', 'auto');
  ga('send', 'pageview');

</script>


  
  <script type="text/javascript">
    if (window.location.hostname == "phil-opp.github.io") {
      window.location.href = "http://os.phil-opp.com/";
    }
  </script>
</head>

<body>
<div class="container content">

<header class="masthead">
  <h3 class="masthead-title">
    <a href="/" title="Home">Writing an OS in Rust</a>
    <span class="navigation">
      <small><a href="/atom.xml"><img src="/images/feed-icon.png" alt="RSS"></a></small>
    </span>
    <small>Philipp&nbsp;Oppermann's&nbsp;blog</small>
  </h3>
</header>

<main>


<div class="front-page-introduction"><p>
  This blog series creates a small operating system in the
  <a href="https://www.rust-lang.org/">Rust programming language</a>. Each post
  is a small tutorial and includes all needed code, so you can follow along if
  you like. The source code is also available in the corresponding
  <a href="https://github.com/phil-opp/blog_os">Github repository</a>.
</p>
<p>Latest post: 
  <strong><a href="/double-faults.html">Double Faults</a></strong>
  
</p></div>

<div id="bare-bones" class="post-category bare-bones">Bare Bones</div>
<div class="posts bare-bones">
  
    <article class="post">
  <h1 class="post-title">
    <a href="/multiboot-kernel.html">
      A minimal x86 kernel
    </a>
  </h1>

  <p>This post explains how to create a minimal x86 operating system kernel. In fact, it will just boot and print <code>OK</code> to the screen. The following blog posts we will extend it using the <a href="http://www.rust-lang.org/">Rust</a> programming language.</p>


</article>

  
    <article class="post">
  <h1 class="post-title">
    <a href="/entering-longmode.html">
      Entering Long Mode
    </a>
  </h1>

  <p>In the <a href="/multiboot-kernel.html">previous post</a> we created a minimal multiboot kernel. It just prints <code>OK</code> and hangs. The goal is to extend it and call 64-bit <a href="http://www.rust-lang.org/">Rust</a> code. But the CPU is currently in <a href="https://en.wikipedia.org/wiki/Protected_mode">protected mode</a> and allows only 32-bit instructions and up to 4GiB memory. So we need to set up <em>Paging</em> and switch to the 64-bit <a href="https://en.wikipedia.org/wiki/Long_mode">long mode</a> first.</p>


</article>

  
    <article class="post">
  <h1 class="post-title">
    <a href="/set-up-rust.html">
      Set Up Rust
    </a>
  </h1>

  <p>In the previous posts we created a <a href="/multiboot-kernel.html">minimal Multiboot kernel</a> and <a href="/entering-longmode.html">switched to Long Mode</a>. Now we can finally switch to <a href="https://www.rust-lang.org/">Rust</a> code. Rust is a high-level language without runtime. It allows us to not link the standard library and write bare metal code. Unfortunately the setup is not quite hassle-free yet.</p>


</article>

  
    <article class="post">
  <h1 class="post-title">
    <a href="/printing-to-screen.html">
      Printing to Screen
    </a>
  </h1>

  <p>In the <a href="/set-up-rust.html">previous post</a> we switched from assembly to <a href="https://www.rust-lang.org/">Rust</a>, a systems programming language that provides great safety. But so far we are using unsafe features like <a href="https://doc.rust-lang.org/book/raw-pointers.html">raw pointers</a> whenever we want to print to screen. In this post we will create a Rust module that provides a safe and easy-to-use interface for the VGA text buffer. It will support Rust&rsquo;s <a href="https://doc.rust-lang.org/std/fmt/#related-macros">formatting macros</a>, too.</p>


</article>

  
</div>

<div id="memory-management" class="post-category memory-management">Memory Management</div>
<div class="posts memory-management">
  
    <article class="post">
  <h1 class="post-title">
    <a href="/allocating-frames.html">
      Allocating Frames
    </a>
  </h1>

  <p>In this post we create an allocator that provides free physical frames for a future paging module. To get the required information about available and used memory we use the Multiboot information structure. Additionally, we improve the <code>panic</code> handler to print the corresponding message and source line.</p>


</article>

  
    <article class="post">
  <h1 class="post-title">
    <a href="/modifying-page-tables.html">
      Page Tables
    </a>
  </h1>

  <p>In this post we will create a paging module, which allows us to access and modify the 4-level page table. We will explore recursive page table mapping and use some Rust features to make it safe. Finally we will create functions to translate virtual addresses and to map and unmap pages.</p>


</article>

  
    <article class="post">
  <h1 class="post-title">
    <a href="/remap-the-kernel.html">
      Remap the Kernel
    </a>
  </h1>

  <p>In this post we will create a new page table to map the kernel sections correctly. Therefore we will extend the paging module to support modifications of <em>inactive</em> page tables as well. Then we will switch to the new table and secure our kernel stack by creating a guard page.</p>


</article>

  
    <article class="post">
  <h1 class="post-title">
    <a href="/kernel-heap.html">
      Kernel Heap
    </a>
  </h1>

  <p>In the previous posts we have created a <a href="/allocating-frames.html">frame allocator</a> and a <a href="/modifying-page-tables.html">page table module</a>. Now we are ready to create a kernel heap and a memory allocator. Thus, we will unlock <code>Box</code>, <code>Vec</code>, <code>BTreeMap</code>, and the rest of the <a href="https://doc.rust-lang.org/nightly/alloc/index.html">alloc</a> and <a href="https://doc.rust-lang.org/nightly/collections/index.html">collections</a> crates.</p>


</article>

  
</div>

<div id="interrupts" class="post-category exceptions">Exceptions</div>
<div class="posts exceptions">
  
    <article class="post">
  <h1 class="post-title">
    <a href="/catching-exceptions.html">
      Catching Exceptions
    </a>
  </h1>

  <p>In this post, we start exploring exceptions. We set up an interrupt descriptor table and add handler functions. At the end of this post, our kernel will be able to catch divide-by-zero faults.</p>


</article>

  
    <article class="post">
  <h1 class="post-title">
    <a href="/better-exception-messages.html">
      Better Exception Messages
    </a>
  </h1>

  <p>In this post, we explore exceptions in more detail. Our goal is to print additional information when an exception occurs, for example the values of the instruction and stack pointer. In the course of this, we will explore inline assembly and naked functions. We will also add a handler function for page faults and read the associated error code.</p>


</article>

  
    <article class="post">
  <h1 class="post-title">
    <a href="/returning-from-exceptions.html">
      Returning from Exceptions
    </a>
  </h1>

  <p>In this post, we learn how to return from exceptions correctly. In the course of this, we will explore the <code>iretq</code> instruction, the C calling convention, multimedia registers, and the red zone.</p>


</article>

  
    <article class="post">
  <h1 class="post-title">
    <a href="/double-faults.html">
      Double Faults
    </a>
  </h1>

  <p>In this post we explore double faults in detail. We also set up an <em>Interrupt Stack Table</em> to catch double faults on a separate kernel stack. This way, we can completely prevent triple faults, even on kernel stack overflow.</p>


</article>

  
</div>

<hr>
<h1>Additional Resources</h1>

<ul>
  
    <li><a href="/cross-compile-binutils.html">Cross Compile Binutils</a>

  
    <li><a href="/cross-compile-libcore.html">Cross Compiling: libcore</a>

  
    <li><a href="/set-up-gdb.html">Set Up GDB</a>

  
</ul>

<hr>
<aside id="recent-updates">
  <h1>Recent Updates</h1>
  <ul><li><a href='https://github.com/phil-opp/blog_os/pull/278'>Remove the data segment from assembly 64-bit GDT</a> <time datetime="2017-01-14 15:56:15 UTC">Jan 14</datetime><li><a href='https://github.com/phil-opp/blog_os/pull/272'>Add a Xargo.toml for xargo 0.3.0 and update the corresponding post</a> <time datetime="2016-12-29 15:45:24 UTC">Dec 29</datetime><li><a href='https://github.com/phil-opp/blog_os/pull/266'>Update x86 crate to version 0.8.0</a> <time datetime="2016-12-21 13:59:58 UTC">Dec 21</datetime><li><a href='https://github.com/phil-opp/blog_os/pull/262'>Mark `panic_fmt` as `no_mangle` to work around rust-lang/rust#38281</a> <time datetime="2016-12-19 10:32:20 UTC">Dec 19</datetime><li><a href='https://github.com/phil-opp/blog_os/pull/252'>Exceptions: Take the ExceptionStackFrame per reference</a> <time datetime="2016-11-01 16:56:25 UTC">Nov 01</datetime></ul>
</aside>

<hr>

</main>

<footer class="footer">
  <small>
    &copy;
    <time datetime="2017">2017</time>. All rights reserved.
    <a href="/contact.html">Contact</a>
  </small>
</footer>
</div>

</body>
</html>

