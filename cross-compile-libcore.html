<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  

  <title>
    Cross Compiling: libcore &middot; Writing an OS in Rust
  </title>

  <link rel="canonical" href="http://os.phil-opp.com/cross-compile-libcore.html">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/syntax.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/images/favicon.ico">

  

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
  <script src="js/toc.min.js"></script>
  <script src="js/main.js"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65296949-1', 'auto');
  ga('send', 'pageview');

</script>


  
  <script type="text/javascript">
    if (window.location.hostname == "phil-opp.github.io") {
      window.location.href = "http://os.phil-opp.com/";
    }
  </script>
</head>

<body>
<div class="container content">

<header class="masthead">
  <h3 class="masthead-title">
    <a href="/" title="Home">Writing an OS in Rust</a>
    <span class="navigation">
      <small><a href="/atom.xml"><img src="/images/feed-icon.png" alt="RSS"></a></small>
    </span>
    <small>Philipp&nbsp;Oppermann's&nbsp;blog</small>
  </h3>
</header>

<main>


<article class="post">
  <h1 class="post-title">Cross Compiling: libcore</h1>

  

<p>If you get an <code>error: can't find crate for 'core'</code>, you&rsquo;re probably compiling for a different target (e.g. you&rsquo;re passing the <code>target</code> option to <code>cargo build</code>). Now the compiler complains that it can&rsquo;t find the <code>core</code> library. This document gives a quick overview how to fix this problem. For more details, see the <a href="https://github.com/japaric/rust-cross">rust-cross</a> project.</p>

<h2 id="libcore">Libcore</h2>

<p>The core library is a dependency-free library that is added implicitly when using <code>#![no_std]</code>. It provides basic standard library features like Option or Iterator. The core library is installed together with the rust compiler (just like the std library). But the installed libcore is specific to your architecture. If you aren&rsquo;t working on x86_64 Linux and pass <code>‑‑target x86_64‑unknown‑linux‑gnu</code> to cargo, it can&rsquo;t find a x86_64 libcore. To fix this, you can either use <code>rustup</code> or <code>xargo</code>.</p>

<h2 id="rustup">rustup</h2>

<p>Thanks to <a href="https://rustup.rs">rustup</a>, cross-compilation for <a href="https://github.com/japaric/rust-cross#the-target-triple">official target triples</a> is pretty easy today: Just execute <code>rustup target add x86_64-unknown-linux-gnu</code>.</p>

<h2 id="xargo">xargo</h2>

<p>If you&rsquo;re using a <em>custom target specification</em>, the <code>rustup</code> method doesn&rsquo;t work. Instead, you can use <a href="https://github.com/japaric/xargo">xargo</a>. Xargo is a wrapper for cargo that eases cross compilation. We can install it by executing:</p>

<pre><code>cargo install xargo
</code></pre>

<p>If the installation fails, make sure that you have <code>cmake</code> and the OpenSSL headers installed. For more details, see the xargo&rsquo;s <a href="https://github.com/japaric/xargo#dependencies">dependency section</a>.</p>

<p>Xargo is “a drop-in replacement for cargo”, so every cargo command also works with <code>xargo</code>. You can do e.g. <code>xargo --help</code>, <code>xargo clean</code>, or <code>xargo doc</code>. However, the <code>build</code> command gains additional functionality: <code>xargo build</code> will automatically cross compile the <code>core</code> library (and a few other libraries such as <code>alloc</code> and <code>collections</code>) when compiling for custom targets.</p>

<p>So if your custom target file is named <code>your-cool-target.json</code>, you can compile your code using xargo through <code>xargo build --target your-cool-target</code> (note the omitted extension).</p>

</article>

<div id="disqus_thread"></div>
<script>
  (function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var d = document, s = d.createElement('script');

    s.src = '//phil-opp.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
  anchors.options = {
    placement: 'left',
  };
  anchors.add('article h2, article h3, article h4, article h5, article h6');
</script>

</main>

<footer class="footer">
  <small>
    &copy;
    <time datetime="2017">2017</time>. All rights reserved.
    <a href="/contact.html">Contact</a>
  </small>
</footer>
</div>

</body>
</html>

